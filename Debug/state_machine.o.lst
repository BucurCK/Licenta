   1              	 .syntax unified
   2              	 .cpu cortex-m4
   3              	 .eabi_attribute 27,3
   4              	 .fpu fpv4-sp-d16
   5              	 .eabi_attribute 20,1
   6              	 .eabi_attribute 21,1
   7              	 .eabi_attribute 23,3
   8              	 .eabi_attribute 24,1
   9              	 .eabi_attribute 25,1
  10              	 .eabi_attribute 26,1
  11              	 .eabi_attribute 30,6
  12              	 .eabi_attribute 34,1
  13              	 .eabi_attribute 18,4
  14              	 .thumb
  15              	 .file "state_machine.c"
  16              	 .text
  17              	.Ltext0:
  18              	 .cfi_sections .debug_frame
  19              	 .comm CCU8_CC8_CR1_CR1_Value,4,4
  20              	 .comm theta_fast,4,4
  21              	 .global drive_status
  22              	 .section .bss.drive_status,"aw",%nobits
  23              	 .align 1
  26              	drive_status:
  27 0000 0000     	 .space 2
  28              	 .global drive_command
  29              	 .section .bss.drive_command,"aw",%nobits
  30              	 .align 1
  33              	drive_command:
  34 0000 0000     	 .space 2
  35              	 .global drive_command_old
  36              	 .section .bss.drive_command_old,"aw",%nobits
  37              	 .align 1
  40              	drive_command_old:
  41 0000 0000     	 .space 2
  42              	 .global loop_control
  43              	 .section .bss.loop_control,"aw",%nobits
  46              	loop_control:
  47 0000 00       	 .space 1
  48              	 .global tune_test_control
  49              	 .section .bss.tune_test_control,"aw",%nobits
  52              	tune_test_control:
  53 0000 00       	 .space 1
  54              	 .global motion_config
  55              	 .section .bss.motion_config,"aw",%nobits
  58              	motion_config:
  59 0000 00       	 .space 1
  60              	 .section .text.state_machine,"ax",%progbits
  61              	 .align 2
  62              	 .global state_machine
  63              	 .thumb
  64              	 .thumb_func
  66              	state_machine:
  67              	.LFB196:
  68              	 .file 1 "../state_machine.c"
   1:../state_machine.c **** /*
   2:../state_machine.c ****  * state_machine.c
   3:../state_machine.c ****  *
   4:../state_machine.c ****  *  Created on: 24 Mar 2023
   5:../state_machine.c ****  *      Author: xraid
   6:../state_machine.c ****  */
   7:../state_machine.c **** #include "main.h"
   8:../state_machine.c **** #include "state_machine.h"
   9:../state_machine.c **** #include "driver_adc.h"
  10:../state_machine.c **** #include "driver_pwm.h"
  11:../state_machine.c **** #include "motor_data_update.h"
  12:../state_machine.c **** #include "reference_generator.h"
  13:../state_machine.c **** #include "transform.h"
  14:../state_machine.c **** 
  15:../state_machine.c **** uint16_t drive_status = STATE_0_DRIVE_DISABLED;
  16:../state_machine.c **** uint16_t drive_command = STATE_0_DRIVE_DISABLED;
  17:../state_machine.c **** uint16_t drive_command_old = STATE_0_DRIVE_DISABLED;
  18:../state_machine.c **** uint8_t loop_control = LOOP_CONTROL_OFF;
  19:../state_machine.c **** uint8_t tune_test_control = OFF;
  20:../state_machine.c **** uint8_t motion_config = OFF;
  21:../state_machine.c **** 
  22:../state_machine.c **** void state_machine (void)
  23:../state_machine.c **** {
  69              	 .loc 1 23 0
  70              	 .cfi_startproc
  71              	 
  72              	 
  73 0000 80B5     	 push {r7,lr}
  74              	.LCFI0:
  75              	 .cfi_def_cfa_offset 8
  76              	 .cfi_offset 7,-8
  77              	 .cfi_offset 14,-4
  78 0002 00AF     	 add r7,sp,#0
  79              	.LCFI1:
  80              	 .cfi_def_cfa_register 7
  24:../state_machine.c **** 	switch(DRIVE_STATUS_MSK)
  81              	 .loc 1 24 0
  82 0004 764B     	 ldr r3,.L19
  83 0006 1B88     	 ldrh r3,[r3]
  84 0008 03F00F03 	 and r3,r3,#15
  85 000c 012B     	 cmp r3,#1
  86 000e 26D0     	 beq .L3
  87 0010 012B     	 cmp r3,#1
  88 0012 02D3     	 bcc .L4
  89 0014 022B     	 cmp r3,#2
  90 0016 61D0     	 beq .L5
  25:../state_machine.c **** 	{
  26:../state_machine.c **** 	case (STATE_0_DRIVE_DISABLED):
  27:../state_machine.c **** 		//Transition 0->1
  28:../state_machine.c **** 		if ((DRIVE_COMMAND_OLD_STATE_MSK == STATE_0_DRIVE_DISABLED) && (DRIVE_COMMAND_STATE_MSK == STATE_
  29:../state_machine.c **** 			{
  30:../state_machine.c **** 				drive_on();
  31:../state_machine.c **** 				drive_status &= DRIVE_STATUS_CLEAR;
  32:../state_machine.c **** 				drive_status |= STATE_1_DRIVE_ON;
  33:../state_machine.c **** 				drive_command_old = drive_command;
  34:../state_machine.c **** 			}
  35:../state_machine.c **** 			break;
  36:../state_machine.c **** 
  37:../state_machine.c **** 	case (STATE_1_DRIVE_ON):
  38:../state_machine.c **** 		//Transition 1->2
  39:../state_machine.c **** 		if ((DRIVE_COMMAND_OLD_STATE_MSK == STATE_1_DRIVE_ON) && (DRIVE_COMMAND_STATE_MSK == STATE_2_OPER
  40:../state_machine.c **** 			{
  41:../state_machine.c **** 				operation_enabled();
  42:../state_machine.c **** 				drive_status &= DRIVE_STATUS_CLEAR;
  43:../state_machine.c **** 				drive_status |= STATE_2_OPERATION_ENABLED;
  44:../state_machine.c **** 				drive_command_old = drive_command;
  45:../state_machine.c **** 			}
  46:../state_machine.c **** 		//Transition 1->0
  47:../state_machine.c **** 		if ((DRIVE_COMMAND_OLD_STATE_MSK == STATE_1_DRIVE_ON) && (DRIVE_COMMAND_STATE_MSK == STATE_0_DRIV
  48:../state_machine.c **** 			{
  49:../state_machine.c **** 			drive_disabled();
  50:../state_machine.c **** 			drive_status &= DRIVE_STATUS_CLEAR;
  51:../state_machine.c **** 			drive_status |= STATE_0_DRIVE_DISABLED;
  52:../state_machine.c **** 			drive_command_old = drive_command;
  53:../state_machine.c **** 			}
  54:../state_machine.c **** 			break;
  55:../state_machine.c **** 
  56:../state_machine.c **** 	case (STATE_2_OPERATION_ENABLED):
  57:../state_machine.c **** 	{
  58:../state_machine.c **** 		//Transition 2->1
  59:../state_machine.c **** 		if ((DRIVE_COMMAND_OLD_STATE_MSK == STATE_2_OPERATION_ENABLED) && (DRIVE_COMMAND_STATE_MSK == STA
  60:../state_machine.c **** 			{
  61:../state_machine.c **** 				drive_on();
  62:../state_machine.c **** 				drive_status &= DRIVE_STATUS_CLEAR;
  63:../state_machine.c **** 				drive_status |= STATE_1_DRIVE_ON;
  64:../state_machine.c **** 				drive_command_old = drive_command;
  65:../state_machine.c **** 			}
  66:../state_machine.c **** 		//Transition 2->0
  67:../state_machine.c **** 		if ((DRIVE_COMMAND_OLD_STATE_MSK == STATE_2_OPERATION_ENABLED) && (DRIVE_COMMAND_STATE_MSK == STA
  68:../state_machine.c **** 			{
  69:../state_machine.c **** 				drive_disabled();
  70:../state_machine.c **** 				drive_status &= DRIVE_STATUS_CLEAR;
  71:../state_machine.c **** 				drive_status |= STATE_0_DRIVE_DISABLED;
  72:../state_machine.c **** 				drive_command_old = drive_command;
  73:../state_machine.c **** 			}
  74:../state_machine.c **** 		//Check for update
  75:../state_machine.c **** 		if((!(DRIVE_COMMAND_UPDATE_OLD_MSK & UPDATE_MSK) && (DRIVE_COMMAND_UPDATE_MSK & UPDATE_MSK)) && (
  76:../state_machine.c **** 		{
  77:../state_machine.c **** 			//Check for reference generator output (Priority list: POS > SPD > I > U)
  78:../state_machine.c **** 			if(DRIVE_COMMAND_REF_MSK & REF_POS_MSK)
  79:../state_machine.c **** 			{
  80:../state_machine.c **** 				//POS REF
  81:../state_machine.c **** 				ref_type_select = REF_POS;
  82:../state_machine.c **** 			}
  83:../state_machine.c **** 			else if(DRIVE_COMMAND_REF_MSK & REF_SPD_MSK)
  84:../state_machine.c **** 			{
  85:../state_machine.c **** 				//SPD REF
  86:../state_machine.c **** 				ref_type_select = REF_SPD;
  87:../state_machine.c **** 			}
  88:../state_machine.c **** 			else if(DRIVE_COMMAND_REF_MSK & REF_I_MSK)
  89:../state_machine.c **** 			{
  90:../state_machine.c **** 				//I REFF
  91:../state_machine.c **** 				ref_type_select = REF_I;
  92:../state_machine.c **** 				if(DRIVE_COMMAND_TEST_MSK & TUNE_TEST)
  93:../state_machine.c **** 				{
  94:../state_machine.c **** 					tune_test_control = ON;
  95:../state_machine.c **** 				}
  96:../state_machine.c **** 			}
  97:../state_machine.c **** 			else
  98:../state_machine.c **** 			{
  99:../state_machine.c **** 				//U REF
 100:../state_machine.c **** 				ref_type_select = REF_U;
 101:../state_machine.c **** 			}
 102:../state_machine.c **** 			compute_motion();
 103:../state_machine.c **** 			drive_command_old = drive_command;
 104:../state_machine.c **** 		}
 105:../state_machine.c **** 	}
 106:../state_machine.c **** 			break;
 107:../state_machine.c **** 	default:
 108:../state_machine.c **** 		break;
  91              	 .loc 1 108 0
  92 0018 E1E0     	 b .L1
  93              	.L4:
  28:../state_machine.c **** 			{
  94              	 .loc 1 28 0
  95 001a 724B     	 ldr r3,.L19+4
  96 001c 1B88     	 ldrh r3,[r3]
  97 001e 03F00F03 	 and r3,r3,#15
  98 0022 002B     	 cmp r3,#0
  99 0024 1AD1     	 bne .L6
  28:../state_machine.c **** 			{
 100              	 .loc 1 28 0 is_stmt 0 discriminator 1
 101 0026 704B     	 ldr r3,.L19+8
 102 0028 1B88     	 ldrh r3,[r3]
 103 002a 03F00F03 	 and r3,r3,#15
 104 002e 012B     	 cmp r3,#1
 105 0030 14D1     	 bne .L6
  30:../state_machine.c **** 				drive_status &= DRIVE_STATUS_CLEAR;
 106              	 .loc 1 30 0 is_stmt 1
 107 0032 FFF7FEFF 	 bl drive_on
  31:../state_machine.c **** 				drive_status |= STATE_1_DRIVE_ON;
 108              	 .loc 1 31 0
 109 0036 6A4B     	 ldr r3,.L19
 110 0038 1B88     	 ldrh r3,[r3]
 111 003a 23F00F03 	 bic r3,r3,#15
 112 003e 9AB2     	 uxth r2,r3
 113 0040 674B     	 ldr r3,.L19
 114 0042 1A80     	 strh r2,[r3]
  32:../state_machine.c **** 				drive_command_old = drive_command;
 115              	 .loc 1 32 0
 116 0044 664B     	 ldr r3,.L19
 117 0046 1B88     	 ldrh r3,[r3]
 118 0048 43F00103 	 orr r3,r3,#1
 119 004c 9AB2     	 uxth r2,r3
 120 004e 644B     	 ldr r3,.L19
 121 0050 1A80     	 strh r2,[r3]
  33:../state_machine.c **** 			}
 122              	 .loc 1 33 0
 123 0052 654B     	 ldr r3,.L19+8
 124 0054 1A88     	 ldrh r2,[r3]
 125 0056 634B     	 ldr r3,.L19+4
 126 0058 1A80     	 strh r2,[r3]
  35:../state_machine.c **** 
 127              	 .loc 1 35 0
 128 005a C0E0     	 b .L1
 129              	.L6:
 130 005c BFE0     	 b .L1
 131              	.L3:
  39:../state_machine.c **** 			{
 132              	 .loc 1 39 0
 133 005e 614B     	 ldr r3,.L19+4
 134 0060 1B88     	 ldrh r3,[r3]
 135 0062 03F00F03 	 and r3,r3,#15
 136 0066 012B     	 cmp r3,#1
 137 0068 19D1     	 bne .L8
  39:../state_machine.c **** 			{
 138              	 .loc 1 39 0 is_stmt 0 discriminator 1
 139 006a 5F4B     	 ldr r3,.L19+8
 140 006c 1B88     	 ldrh r3,[r3]
 141 006e 03F00F03 	 and r3,r3,#15
 142 0072 022B     	 cmp r3,#2
 143 0074 13D1     	 bne .L8
  41:../state_machine.c **** 				drive_status &= DRIVE_STATUS_CLEAR;
 144              	 .loc 1 41 0 is_stmt 1
 145 0076 FFF7FEFF 	 bl operation_enabled
  42:../state_machine.c **** 				drive_status |= STATE_2_OPERATION_ENABLED;
 146              	 .loc 1 42 0
 147 007a 594B     	 ldr r3,.L19
 148 007c 1B88     	 ldrh r3,[r3]
 149 007e 23F00F03 	 bic r3,r3,#15
 150 0082 9AB2     	 uxth r2,r3
 151 0084 564B     	 ldr r3,.L19
 152 0086 1A80     	 strh r2,[r3]
  43:../state_machine.c **** 				drive_command_old = drive_command;
 153              	 .loc 1 43 0
 154 0088 554B     	 ldr r3,.L19
 155 008a 1B88     	 ldrh r3,[r3]
 156 008c 43F00203 	 orr r3,r3,#2
 157 0090 9AB2     	 uxth r2,r3
 158 0092 534B     	 ldr r3,.L19
 159 0094 1A80     	 strh r2,[r3]
  44:../state_machine.c **** 			}
 160              	 .loc 1 44 0
 161 0096 544B     	 ldr r3,.L19+8
 162 0098 1A88     	 ldrh r2,[r3]
 163 009a 524B     	 ldr r3,.L19+4
 164 009c 1A80     	 strh r2,[r3]
 165              	.L8:
  47:../state_machine.c **** 			{
 166              	 .loc 1 47 0
 167 009e 514B     	 ldr r3,.L19+4
 168 00a0 1B88     	 ldrh r3,[r3]
 169 00a2 03F00F03 	 and r3,r3,#15
 170 00a6 012B     	 cmp r3,#1
 171 00a8 17D1     	 bne .L9
  47:../state_machine.c **** 			{
 172              	 .loc 1 47 0 is_stmt 0 discriminator 1
 173 00aa 4F4B     	 ldr r3,.L19+8
 174 00ac 1B88     	 ldrh r3,[r3]
 175 00ae 03F00F03 	 and r3,r3,#15
 176 00b2 002B     	 cmp r3,#0
 177 00b4 11D1     	 bne .L9
  49:../state_machine.c **** 			drive_status &= DRIVE_STATUS_CLEAR;
 178              	 .loc 1 49 0 is_stmt 1
 179 00b6 FFF7FEFF 	 bl drive_disabled
  50:../state_machine.c **** 			drive_status |= STATE_0_DRIVE_DISABLED;
 180              	 .loc 1 50 0
 181 00ba 494B     	 ldr r3,.L19
 182 00bc 1B88     	 ldrh r3,[r3]
 183 00be 23F00F03 	 bic r3,r3,#15
 184 00c2 9AB2     	 uxth r2,r3
 185 00c4 464B     	 ldr r3,.L19
 186 00c6 1A80     	 strh r2,[r3]
  51:../state_machine.c **** 			drive_command_old = drive_command;
 187              	 .loc 1 51 0
 188 00c8 454B     	 ldr r3,.L19
 189 00ca 1A88     	 ldrh r2,[r3]
 190 00cc 444B     	 ldr r3,.L19
 191 00ce 1A80     	 strh r2,[r3]
  52:../state_machine.c **** 			}
 192              	 .loc 1 52 0
 193 00d0 454B     	 ldr r3,.L19+8
 194 00d2 1A88     	 ldrh r2,[r3]
 195 00d4 434B     	 ldr r3,.L19+4
 196 00d6 1A80     	 strh r2,[r3]
  54:../state_machine.c **** 
 197              	 .loc 1 54 0
 198 00d8 81E0     	 b .L1
 199              	.L9:
 200 00da 80E0     	 b .L1
 201              	.L5:
  59:../state_machine.c **** 			{
 202              	 .loc 1 59 0
 203 00dc 414B     	 ldr r3,.L19+4
 204 00de 1B88     	 ldrh r3,[r3]
 205 00e0 03F00F03 	 and r3,r3,#15
 206 00e4 022B     	 cmp r3,#2
 207 00e6 19D1     	 bne .L10
  59:../state_machine.c **** 			{
 208              	 .loc 1 59 0 is_stmt 0 discriminator 1
 209 00e8 3F4B     	 ldr r3,.L19+8
 210 00ea 1B88     	 ldrh r3,[r3]
 211 00ec 03F00F03 	 and r3,r3,#15
 212 00f0 012B     	 cmp r3,#1
 213 00f2 13D1     	 bne .L10
  61:../state_machine.c **** 				drive_status &= DRIVE_STATUS_CLEAR;
 214              	 .loc 1 61 0 is_stmt 1
 215 00f4 FFF7FEFF 	 bl drive_on
  62:../state_machine.c **** 				drive_status |= STATE_1_DRIVE_ON;
 216              	 .loc 1 62 0
 217 00f8 394B     	 ldr r3,.L19
 218 00fa 1B88     	 ldrh r3,[r3]
 219 00fc 23F00F03 	 bic r3,r3,#15
 220 0100 9AB2     	 uxth r2,r3
 221 0102 374B     	 ldr r3,.L19
 222 0104 1A80     	 strh r2,[r3]
  63:../state_machine.c **** 				drive_command_old = drive_command;
 223              	 .loc 1 63 0
 224 0106 364B     	 ldr r3,.L19
 225 0108 1B88     	 ldrh r3,[r3]
 226 010a 43F00103 	 orr r3,r3,#1
 227 010e 9AB2     	 uxth r2,r3
 228 0110 334B     	 ldr r3,.L19
 229 0112 1A80     	 strh r2,[r3]
  64:../state_machine.c **** 			}
 230              	 .loc 1 64 0
 231 0114 344B     	 ldr r3,.L19+8
 232 0116 1A88     	 ldrh r2,[r3]
 233 0118 324B     	 ldr r3,.L19+4
 234 011a 1A80     	 strh r2,[r3]
 235              	.L10:
  67:../state_machine.c **** 			{
 236              	 .loc 1 67 0
 237 011c 314B     	 ldr r3,.L19+4
 238 011e 1B88     	 ldrh r3,[r3]
 239 0120 03F00F03 	 and r3,r3,#15
 240 0124 022B     	 cmp r3,#2
 241 0126 16D1     	 bne .L11
  67:../state_machine.c **** 			{
 242              	 .loc 1 67 0 is_stmt 0 discriminator 1
 243 0128 2F4B     	 ldr r3,.L19+8
 244 012a 1B88     	 ldrh r3,[r3]
 245 012c 03F00F03 	 and r3,r3,#15
 246 0130 002B     	 cmp r3,#0
 247 0132 10D1     	 bne .L11
  69:../state_machine.c **** 				drive_status &= DRIVE_STATUS_CLEAR;
 248              	 .loc 1 69 0 is_stmt 1
 249 0134 FFF7FEFF 	 bl drive_disabled
  70:../state_machine.c **** 				drive_status |= STATE_0_DRIVE_DISABLED;
 250              	 .loc 1 70 0
 251 0138 294B     	 ldr r3,.L19
 252 013a 1B88     	 ldrh r3,[r3]
 253 013c 23F00F03 	 bic r3,r3,#15
 254 0140 9AB2     	 uxth r2,r3
 255 0142 274B     	 ldr r3,.L19
 256 0144 1A80     	 strh r2,[r3]
  71:../state_machine.c **** 				drive_command_old = drive_command;
 257              	 .loc 1 71 0
 258 0146 264B     	 ldr r3,.L19
 259 0148 1A88     	 ldrh r2,[r3]
 260 014a 254B     	 ldr r3,.L19
 261 014c 1A80     	 strh r2,[r3]
  72:../state_machine.c **** 			}
 262              	 .loc 1 72 0
 263 014e 264B     	 ldr r3,.L19+8
 264 0150 1A88     	 ldrh r2,[r3]
 265 0152 244B     	 ldr r3,.L19+4
 266 0154 1A80     	 strh r2,[r3]
 267              	.L11:
  75:../state_machine.c **** 		{
 268              	 .loc 1 75 0
 269 0156 234B     	 ldr r3,.L19+4
 270 0158 1B88     	 ldrh r3,[r3]
 271 015a 03F01003 	 and r3,r3,#16
 272 015e 002B     	 cmp r3,#0
 273 0160 3CD1     	 bne .L12
  75:../state_machine.c **** 		{
 274              	 .loc 1 75 0 is_stmt 0 discriminator 1
 275 0162 214B     	 ldr r3,.L19+8
 276 0164 1B88     	 ldrh r3,[r3]
 277 0166 03F01003 	 and r3,r3,#16
 278 016a 002B     	 cmp r3,#0
 279 016c 36D0     	 beq .L12
  75:../state_machine.c **** 		{
 280              	 .loc 1 75 0 discriminator 2
 281 016e 1E4B     	 ldr r3,.L19+8
 282 0170 1B88     	 ldrh r3,[r3]
 283 0172 03F00F03 	 and r3,r3,#15
 284 0176 022B     	 cmp r3,#2
 285 0178 30D1     	 bne .L12
  78:../state_machine.c **** 			{
 286              	 .loc 1 78 0 is_stmt 1
 287 017a 1B4B     	 ldr r3,.L19+8
 288 017c 1B88     	 ldrh r3,[r3]
 289 017e 03F48063 	 and r3,r3,#1024
 290 0182 002B     	 cmp r3,#0
 291 0184 03D0     	 beq .L13
  81:../state_machine.c **** 			}
 292              	 .loc 1 81 0
 293 0186 194B     	 ldr r3,.L19+12
 294 0188 0022     	 movs r2,#0
 295 018a 1A70     	 strb r2,[r3]
 296 018c 1FE0     	 b .L14
 297              	.L13:
  83:../state_machine.c **** 			{
 298              	 .loc 1 83 0
 299 018e 164B     	 ldr r3,.L19+8
 300 0190 1B88     	 ldrh r3,[r3]
 301 0192 03F40073 	 and r3,r3,#512
 302 0196 002B     	 cmp r3,#0
 303 0198 03D0     	 beq .L15
  86:../state_machine.c **** 			}
 304              	 .loc 1 86 0
 305 019a 144B     	 ldr r3,.L19+12
 306 019c 0122     	 movs r2,#1
 307 019e 1A70     	 strb r2,[r3]
 308 01a0 15E0     	 b .L14
 309              	.L15:
  88:../state_machine.c **** 			{
 310              	 .loc 1 88 0
 311 01a2 114B     	 ldr r3,.L19+8
 312 01a4 1B88     	 ldrh r3,[r3]
 313 01a6 03F48073 	 and r3,r3,#256
 314 01aa 002B     	 cmp r3,#0
 315 01ac 0CD0     	 beq .L16
  91:../state_machine.c **** 				if(DRIVE_COMMAND_TEST_MSK & TUNE_TEST)
 316              	 .loc 1 91 0
 317 01ae 0F4B     	 ldr r3,.L19+12
 318 01b0 0222     	 movs r2,#2
 319 01b2 1A70     	 strb r2,[r3]
  92:../state_machine.c **** 				{
 320              	 .loc 1 92 0
 321 01b4 0C4B     	 ldr r3,.L19+8
 322 01b6 1B88     	 ldrh r3,[r3]
 323 01b8 9BB2     	 uxth r3,r3
 324 01ba 1BB2     	 sxth r3,r3
 325 01bc 002B     	 cmp r3,#0
 326 01be 06DA     	 bge .L14
  94:../state_machine.c **** 				}
 327              	 .loc 1 94 0
 328 01c0 0B4B     	 ldr r3,.L19+16
 329 01c2 0122     	 movs r2,#1
 330 01c4 1A70     	 strb r2,[r3]
 331 01c6 02E0     	 b .L14
 332              	.L16:
 100:../state_machine.c **** 			}
 333              	 .loc 1 100 0
 334 01c8 084B     	 ldr r3,.L19+12
 335 01ca 0322     	 movs r2,#3
 336 01cc 1A70     	 strb r2,[r3]
 337              	.L14:
 102:../state_machine.c **** 			drive_command_old = drive_command;
 338              	 .loc 1 102 0
 339 01ce FFF7FEFF 	 bl compute_motion
 103:../state_machine.c **** 		}
 340              	 .loc 1 103 0
 341 01d2 054B     	 ldr r3,.L19+8
 342 01d4 1A88     	 ldrh r2,[r3]
 343 01d6 034B     	 ldr r3,.L19+4
 344 01d8 1A80     	 strh r2,[r3]
 106:../state_machine.c **** 	default:
 345              	 .loc 1 106 0
 346 01da FFE7     	 b .L18
 347              	.L12:
 348              	.L18:
 349 01dc 00BF     	 nop
 350              	.L1:
 109:../state_machine.c **** 	}
 110:../state_machine.c **** }
 351              	 .loc 1 110 0
 352 01de 80BD     	 pop {r7,pc}
 353              	.L20:
 354              	 .align 2
 355              	.L19:
 356 01e0 00000000 	 .word drive_status
 357 01e4 00000000 	 .word drive_command_old
 358 01e8 00000000 	 .word drive_command
 359 01ec 00000000 	 .word ref_type_select
 360 01f0 00000000 	 .word tune_test_control
 361              	 .cfi_endproc
 362              	.LFE196:
 364              	 .section .text.drive_disabled,"ax",%progbits
 365              	 .align 2
 366              	 .global drive_disabled
 367              	 .thumb
 368              	 .thumb_func
 370              	drive_disabled:
 371              	.LFB197:
 111:../state_machine.c **** 
 112:../state_machine.c **** void drive_disabled (void)
 113:../state_machine.c **** {
 372              	 .loc 1 113 0
 373              	 .cfi_startproc
 374              	 
 375              	 
 376 0000 80B5     	 push {r7,lr}
 377              	.LCFI2:
 378              	 .cfi_def_cfa_offset 8
 379              	 .cfi_offset 7,-8
 380              	 .cfi_offset 14,-4
 381 0002 00AF     	 add r7,sp,#0
 382              	.LCFI3:
 383              	 .cfi_def_cfa_register 7
 114:../state_machine.c **** 	motion_off();						//PWM off
 384              	 .loc 1 114 0
 385 0004 FFF7FEFF 	 bl motion_off
 115:../state_machine.c **** 	loop_control = LOOP_CONTROL_OFF;	//control_loop_off
 386              	 .loc 1 115 0
 387 0008 064B     	 ldr r3,.L22
 388 000a 0022     	 movs r2,#0
 389 000c 1A70     	 strb r2,[r3]
 116:../state_machine.c **** 	ref_gen_status = STATUS_0_DISABLED;
 390              	 .loc 1 116 0
 391 000e 064B     	 ldr r3,.L22+4
 392 0010 0022     	 movs r2,#0
 393 0012 1A70     	 strb r2,[r3]
 117:../state_machine.c **** 	tune_test_control = OFF;
 394              	 .loc 1 117 0
 395 0014 054B     	 ldr r3,.L22+8
 396 0016 0022     	 movs r2,#0
 397 0018 1A70     	 strb r2,[r3]
 118:../state_machine.c **** 	motion_config = OFF;
 398              	 .loc 1 118 0
 399 001a 054B     	 ldr r3,.L22+12
 400 001c 0022     	 movs r2,#0
 401 001e 1A70     	 strb r2,[r3]
 119:../state_machine.c **** }
 402              	 .loc 1 119 0
 403 0020 80BD     	 pop {r7,pc}
 404              	.L23:
 405 0022 00BF     	 .align 2
 406              	.L22:
 407 0024 00000000 	 .word loop_control
 408 0028 00000000 	 .word ref_gen_status
 409 002c 00000000 	 .word tune_test_control
 410 0030 00000000 	 .word motion_config
 411              	 .cfi_endproc
 412              	.LFE197:
 414              	 .section .text.drive_on,"ax",%progbits
 415              	 .align 2
 416              	 .global drive_on
 417              	 .thumb
 418              	 .thumb_func
 420              	drive_on:
 421              	.LFB198:
 120:../state_machine.c **** 
 121:../state_machine.c **** void drive_on (void)
 122:../state_machine.c **** {
 422              	 .loc 1 122 0
 423              	 .cfi_startproc
 424              	 
 425              	 
 426 0000 80B5     	 push {r7,lr}
 427              	.LCFI4:
 428              	 .cfi_def_cfa_offset 8
 429              	 .cfi_offset 7,-8
 430              	 .cfi_offset 14,-4
 431 0002 00AF     	 add r7,sp,#0
 432              	.LCFI5:
 433              	 .cfi_def_cfa_register 7
 123:../state_machine.c **** 	motion_off();						//PWM off
 434              	 .loc 1 123 0
 435 0004 FFF7FEFF 	 bl motion_off
 124:../state_machine.c **** 	current_offset();
 436              	 .loc 1 124 0
 437 0008 FFF7FEFF 	 bl current_offset
 125:../state_machine.c **** 	init_position();
 438              	 .loc 1 125 0
 439 000c FFF7FEFF 	 bl init_position
 126:../state_machine.c **** 	pwm_update(0, 0, 0);				//pwm_on_50%
 440              	 .loc 1 126 0
 441 0010 0020     	 movs r0,#0
 442 0012 0021     	 movs r1,#0
 443 0014 0022     	 movs r2,#0
 444 0016 FFF7FEFF 	 bl pwm_update
 127:../state_machine.c **** 	motion_on();
 445              	 .loc 1 127 0
 446 001a FFF7FEFF 	 bl motion_on
 128:../state_machine.c **** 	loop_control = LOOP_CONTROL_OFF;	//control_loop_off
 447              	 .loc 1 128 0
 448 001e 064B     	 ldr r3,.L25
 449 0020 0022     	 movs r2,#0
 450 0022 1A70     	 strb r2,[r3]
 129:../state_machine.c **** 	ref_gen_status = STATUS_0_DISABLED;
 451              	 .loc 1 129 0
 452 0024 054B     	 ldr r3,.L25+4
 453 0026 0022     	 movs r2,#0
 454 0028 1A70     	 strb r2,[r3]
 130:../state_machine.c **** 	tune_test_control = OFF;
 455              	 .loc 1 130 0
 456 002a 054B     	 ldr r3,.L25+8
 457 002c 0022     	 movs r2,#0
 458 002e 1A70     	 strb r2,[r3]
 131:../state_machine.c **** 	motion_config = OFF;
 459              	 .loc 1 131 0
 460 0030 044B     	 ldr r3,.L25+12
 461 0032 0022     	 movs r2,#0
 462 0034 1A70     	 strb r2,[r3]
 132:../state_machine.c **** }
 463              	 .loc 1 132 0
 464 0036 80BD     	 pop {r7,pc}
 465              	.L26:
 466              	 .align 2
 467              	.L25:
 468 0038 00000000 	 .word loop_control
 469 003c 00000000 	 .word ref_gen_status
 470 0040 00000000 	 .word tune_test_control
 471 0044 00000000 	 .word motion_config
 472              	 .cfi_endproc
 473              	.LFE198:
 475              	 .section .text.operation_enabled,"ax",%progbits
 476              	 .align 2
 477              	 .global operation_enabled
 478              	 .thumb
 479              	 .thumb_func
 481              	operation_enabled:
 482              	.LFB199:
 133:../state_machine.c **** 
 134:../state_machine.c **** void operation_enabled (void)
 135:../state_machine.c **** {
 483              	 .loc 1 135 0
 484              	 .cfi_startproc
 485              	 
 486              	 
 487              	 
 488 0000 80B4     	 push {r7}
 489              	.LCFI6:
 490              	 .cfi_def_cfa_offset 4
 491              	 .cfi_offset 7,-4
 492 0002 00AF     	 add r7,sp,#0
 493              	.LCFI7:
 494              	 .cfi_def_cfa_register 7
 136:../state_machine.c **** 	loop_control = LOOP_CONTROL_ON;		//control_loop_on
 495              	 .loc 1 136 0
 496 0004 044B     	 ldr r3,.L28
 497 0006 0122     	 movs r2,#1
 498 0008 1A70     	 strb r2,[r3]
 137:../state_machine.c **** 	ref_gen_status = STATUS_0_DISABLED;
 499              	 .loc 1 137 0
 500 000a 044B     	 ldr r3,.L28+4
 501 000c 0022     	 movs r2,#0
 502 000e 1A70     	 strb r2,[r3]
 138:../state_machine.c **** 
 139:../state_machine.c **** }
 503              	 .loc 1 139 0
 504 0010 BD46     	 mov sp,r7
 505              	.LCFI8:
 506              	 .cfi_def_cfa_register 13
 507              	 
 508 0012 5DF8047B 	 ldr r7,[sp],#4
 509              	.LCFI9:
 510              	 .cfi_restore 7
 511              	 .cfi_def_cfa_offset 0
 512 0016 7047     	 bx lr
 513              	.L29:
 514              	 .align 2
 515              	.L28:
 516 0018 00000000 	 .word loop_control
 517 001c 00000000 	 .word ref_gen_status
 518              	 .cfi_endproc
 519              	.LFE199:
 521              	 .section .text.compute_motion,"ax",%progbits
 522              	 .align 2
 523              	 .global compute_motion
 524              	 .thumb
 525              	 .thumb_func
 527              	compute_motion:
 528              	.LFB200:
 140:../state_machine.c **** 
 141:../state_machine.c **** void compute_motion (void)
 142:../state_machine.c **** {
 529              	 .loc 1 142 0
 530              	 .cfi_startproc
 531              	 
 532              	 
 533 0000 80B5     	 push {r7,lr}
 534              	.LCFI10:
 535              	 .cfi_def_cfa_offset 8
 536              	 .cfi_offset 7,-8
 537              	 .cfi_offset 14,-4
 538 0002 00AF     	 add r7,sp,#0
 539              	.LCFI11:
 540              	 .cfi_def_cfa_register 7
 143:../state_machine.c **** 	reference_generator_compute();
 541              	 .loc 1 143 0
 542 0004 FFF7FEFF 	 bl reference_generator_compute
 144:../state_machine.c **** 	motion_config = ON;
 543              	 .loc 1 144 0
 544 0008 014B     	 ldr r3,.L31
 545 000a 0122     	 movs r2,#1
 546 000c 1A70     	 strb r2,[r3]
 145:../state_machine.c **** }
 547              	 .loc 1 145 0
 548 000e 80BD     	 pop {r7,pc}
 549              	.L32:
 550              	 .align 2
 551              	.L31:
 552 0010 00000000 	 .word motion_config
 553              	 .cfi_endproc
 554              	.LFE200:
 556              	 .text
 557              	.Letext0:
 558              	 .file 2 "c:\\dave-ide-4.4.2-64bit\\eclipse\\arm-gcc-49\\arm-none-eabi\\include\\machine\\_default_types.h"
 559              	 .file 3 "c:\\dave-ide-4.4.2-64bit\\eclipse\\arm-gcc-49\\arm-none-eabi\\include\\stdint.h"
 560              	 .file 4 "../reference_generator.h"
 561              	 .file 5 "C:/CODE/Licenta/Libraries/CMSIS/Include/core_cm4.h"
 562              	 .file 6 "../main.h"
 563              	 .file 7 "../transform.h"
DEFINED SYMBOLS
                            *ABS*:00000000 state_machine.c
                            *COM*:00000004 CCU8_CC8_CR1_CR1_Value
                            *COM*:00000004 theta_fast
    {standard input}:26     .bss.drive_status:00000000 drive_status
    {standard input}:23     .bss.drive_status:00000000 $d
    {standard input}:33     .bss.drive_command:00000000 drive_command
    {standard input}:30     .bss.drive_command:00000000 $d
    {standard input}:40     .bss.drive_command_old:00000000 drive_command_old
    {standard input}:37     .bss.drive_command_old:00000000 $d
    {standard input}:46     .bss.loop_control:00000000 loop_control
    {standard input}:47     .bss.loop_control:00000000 $d
    {standard input}:52     .bss.tune_test_control:00000000 tune_test_control
    {standard input}:53     .bss.tune_test_control:00000000 $d
    {standard input}:58     .bss.motion_config:00000000 motion_config
    {standard input}:59     .bss.motion_config:00000000 $d
    {standard input}:61     .text.state_machine:00000000 $t
    {standard input}:66     .text.state_machine:00000000 state_machine
    {standard input}:420    .text.drive_on:00000000 drive_on
    {standard input}:481    .text.operation_enabled:00000000 operation_enabled
    {standard input}:370    .text.drive_disabled:00000000 drive_disabled
    {standard input}:527    .text.compute_motion:00000000 compute_motion
    {standard input}:356    .text.state_machine:000001e0 $d
    {standard input}:365    .text.drive_disabled:00000000 $t
    {standard input}:407    .text.drive_disabled:00000024 $d
    {standard input}:415    .text.drive_on:00000000 $t
    {standard input}:468    .text.drive_on:00000038 $d
    {standard input}:476    .text.operation_enabled:00000000 $t
    {standard input}:516    .text.operation_enabled:00000018 $d
    {standard input}:522    .text.compute_motion:00000000 $t
    {standard input}:552    .text.compute_motion:00000010 $d
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
ref_type_select
motion_off
ref_gen_status
current_offset
init_position
pwm_update
motion_on
reference_generator_compute
