   1              	 .syntax unified
   2              	 .cpu cortex-m4
   3              	 .eabi_attribute 27,3
   4              	 .fpu fpv4-sp-d16
   5              	 .eabi_attribute 20,1
   6              	 .eabi_attribute 21,1
   7              	 .eabi_attribute 23,3
   8              	 .eabi_attribute 24,1
   9              	 .eabi_attribute 25,1
  10              	 .eabi_attribute 26,1
  11              	 .eabi_attribute 30,6
  12              	 .eabi_attribute 34,1
  13              	 .eabi_attribute 18,4
  14              	 .thumb
  15              	 .file "transform.c"
  16              	 .text
  17              	.Ltext0:
  18              	 .cfi_sections .debug_frame
  19              	 .comm CCU8_CC8_CR1_CR1_Value,4,4
  20              	 .global mechanical_position_fast
  21              	 .section .bss.mechanical_position_fast,"aw",%nobits
  22              	 .align 2
  25              	mechanical_position_fast:
  26 0000 00000000 	 .space 4
  27              	 .global electrical_position_modulo_fast
  28              	 .section .bss.electrical_position_modulo_fast,"aw",%nobits
  29              	 .align 2
  32              	electrical_position_modulo_fast:
  33 0000 00000000 	 .space 4
  34              	 .global theta_fast
  35              	 .section .bss.theta_fast,"aw",%nobits
  36              	 .align 2
  39              	theta_fast:
  40 0000 00000000 	 .space 4
  41              	 .global sin_theta_fast
  42              	 .section .bss.sin_theta_fast,"aw",%nobits
  43              	 .align 2
  46              	sin_theta_fast:
  47 0000 00000000 	 .space 4
  48              	 .global cos_theta_fast
  49              	 .section .bss.cos_theta_fast,"aw",%nobits
  50              	 .align 2
  53              	cos_theta_fast:
  54 0000 00000000 	 .space 4
  55              	 .global timer_value_fast
  56              	 .section .bss.timer_value_fast,"aw",%nobits
  57              	 .align 1
  60              	timer_value_fast:
  61 0000 0000     	 .space 2
  62              	 .global timer_value_old_fast
  63              	 .section .bss.timer_value_old_fast,"aw",%nobits
  64              	 .align 1
  67              	timer_value_old_fast:
  68 0000 0000     	 .space 2
  69              	 .global speed_value_fast
  70              	 .section .bss.speed_value_fast,"aw",%nobits
  71              	 .align 1
  74              	speed_value_fast:
  75 0000 0000     	 .space 2
  76              	 .global encoder_resolution
  77              	 .section .data.encoder_resolution,"aw",%progbits
  78              	 .align 1
  81              	encoder_resolution:
  82 0000 A00F     	 .short 4000
  83              	 .global pp
  84              	 .section .data.pp,"aw",%progbits
  87              	pp:
  88 0000 19       	 .byte 25
  89              	 .global electrical_resolution
  90              	 .section .bss.electrical_resolution,"aw",%nobits
  91              	 .align 1
  94              	electrical_resolution:
  95 0000 0000     	 .space 2
  96              	 .comm u_a_ref,4,4
  97              	 .comm u_b_ref,4,4
  98              	 .comm u_c_ref,4,4
  99              	 .comm i_d,4,4
 100              	 .comm i_q,4,4
 101              	 .comm i_alpha,4,4
 102              	 .comm i_beta,4,4
 103              	 .comm u_alpha,4,4
 104              	 .comm u_beta,4,4
 105              	 .section .text.abc_dq,"ax",%progbits
 106              	 .align 2
 107              	 .global abc_dq
 108              	 .thumb
 109              	 .thumb_func
 111              	abc_dq:
 112              	.LFB196:
 113              	 .file 1 "../transform.c"
   1:../transform.c **** #include <stdint.h>
   2:../transform.c **** #include <stdbool.h>
   3:../transform.c **** #include <xmc_common.h>
   4:../transform.c **** #include "driver_pwm.h"
   5:../transform.c **** #include "motor_data_update.h"
   6:../transform.c **** #include "transform.h"
   7:../transform.c **** #include "main.h"
   8:../transform.c **** #include <math.h>
   9:../transform.c **** #include "Encoder.h"
  10:../transform.c **** #include "driver_adc.h"
  11:../transform.c **** #include "pi_regulator.h"
  12:../transform.c **** #include "state_machine.h"
  13:../transform.c **** #include <math.h>
  14:../transform.c **** 
  15:../transform.c **** int32_t mechanical_position_fast = 0;		 // compute the mechanical position of the motor based on sp
  16:../transform.c **** int32_t electrical_position_modulo_fast = 0; // the module of electrical position based on electric
  17:../transform.c **** float_t theta_fast = 0;						 // electric angle
  18:../transform.c **** float_t sin_theta_fast = 0;					 // sin(theta)
  19:../transform.c **** float_t cos_theta_fast = 0;					 // cos(theta)
  20:../transform.c **** uint16_t timer_value_fast = 0;				 // Stored value of CCU40 timer for encoder
  21:../transform.c **** uint16_t timer_value_old_fast = 0;			 //*Last* read of timer value for speed computation
  22:../transform.c **** int16_t speed_value_fast = 0;				 // Speed value based on 2 timer values
  23:../transform.c **** int16_t encoder_resolution = 4000;			 // Resolution of encoder | 4*1000
  24:../transform.c **** int8_t pp = 25;								 // Number of electric poles
  25:../transform.c **** int16_t electrical_resolution = 0;			 // Electrical resolution based on encoder resolution and numb
  26:../transform.c **** float_t u_a_ref, u_b_ref, u_c_ref;			 // abc voltage | -32768 -- 32,767
  27:../transform.c **** float_t i_d, i_q;							 // dq voltage																   *
  28:../transform.c **** float_t i_alpha, i_beta;					 // currents for dq computation
  29:../transform.c **** float_t u_alpha, u_beta;					 // voltage for abc computation
  30:../transform.c **** 
  31:../transform.c **** /*
  32:../transform.c ****  * Convert three-phase electrical signals from time-domain to dq0-reference frame
  33:../transform.c ****  */
  34:../transform.c **** void abc_dq(void)
  35:../transform.c **** {
 114              	 .loc 1 35 0
 115              	 .cfi_startproc
 116              	 
 117              	 
 118              	 
 119 0000 80B4     	 push {r7}
 120              	.LCFI0:
 121              	 .cfi_def_cfa_offset 4
 122              	 .cfi_offset 7,-4
 123 0002 00AF     	 add r7,sp,#0
 124              	.LCFI1:
 125              	 .cfi_def_cfa_register 7
  36:../transform.c **** 	// The Clarke Transformation
  37:../transform.c **** 	i_alpha = ia;
 126              	 .loc 1 37 0
 127 0004 204B     	 ldr r3,.L2
 128 0006 1B88     	 ldrh r3,[r3]
 129 0008 1BB2     	 sxth r3,r3
 130 000a 07EE903A 	 fmsr s15,r3
 131 000e F8EEE77A 	 fsitos s15,s15
 132 0012 1E4B     	 ldr r3,.L2+4
 133 0014 C3ED007A 	 fsts s15,[r3]
  38:../transform.c **** //	i_beta = F_1_SQRT_3 * (float_t)(ia + (float_t)(2 * ib));
  39:../transform.c **** 	i_beta = ic;
 134              	 .loc 1 39 0
 135 0018 1D4B     	 ldr r3,.L2+8
 136 001a 1B88     	 ldrh r3,[r3]
 137 001c 1BB2     	 sxth r3,r3
 138 001e 07EE903A 	 fmsr s15,r3
 139 0022 F8EEE77A 	 fsitos s15,s15
 140 0026 1B4B     	 ldr r3,.L2+12
 141 0028 C3ED007A 	 fsts s15,[r3]
  40:../transform.c **** 
  41:../transform.c **** 	// The Park Transformation
  42:../transform.c **** 	i_d = i_alpha * cos_theta_fast + i_beta * sin_theta_fast;
 142              	 .loc 1 42 0
 143 002c 174B     	 ldr r3,.L2+4
 144 002e 93ED007A 	 flds s14,[r3]
 145 0032 194B     	 ldr r3,.L2+16
 146 0034 D3ED007A 	 flds s15,[r3]
 147 0038 27EE277A 	 fmuls s14,s14,s15
 148 003c 154B     	 ldr r3,.L2+12
 149 003e D3ED006A 	 flds s13,[r3]
 150 0042 164B     	 ldr r3,.L2+20
 151 0044 D3ED007A 	 flds s15,[r3]
 152 0048 66EEA77A 	 fmuls s15,s13,s15
 153 004c 77EE277A 	 fadds s15,s14,s15
 154 0050 134B     	 ldr r3,.L2+24
 155 0052 C3ED007A 	 fsts s15,[r3]
  43:../transform.c **** 	i_q = i_beta * cos_theta_fast - i_alpha * sin_theta_fast;
 156              	 .loc 1 43 0
 157 0056 0F4B     	 ldr r3,.L2+12
 158 0058 93ED007A 	 flds s14,[r3]
 159 005c 0E4B     	 ldr r3,.L2+16
 160 005e D3ED007A 	 flds s15,[r3]
 161 0062 27EE277A 	 fmuls s14,s14,s15
 162 0066 094B     	 ldr r3,.L2+4
 163 0068 D3ED006A 	 flds s13,[r3]
 164 006c 0B4B     	 ldr r3,.L2+20
 165 006e D3ED007A 	 flds s15,[r3]
 166 0072 66EEA77A 	 fmuls s15,s13,s15
 167 0076 77EE677A 	 fsubs s15,s14,s15
 168 007a 0A4B     	 ldr r3,.L2+28
 169 007c C3ED007A 	 fsts s15,[r3]
  44:../transform.c **** }
 170              	 .loc 1 44 0
 171 0080 BD46     	 mov sp,r7
 172              	.LCFI2:
 173              	 .cfi_def_cfa_register 13
 174              	 
 175 0082 5DF8047B 	 ldr r7,[sp],#4
 176              	.LCFI3:
 177              	 .cfi_restore 7
 178              	 .cfi_def_cfa_offset 0
 179 0086 7047     	 bx lr
 180              	.L3:
 181              	 .align 2
 182              	.L2:
 183 0088 00000000 	 .word ia
 184 008c 00000000 	 .word i_alpha
 185 0090 00000000 	 .word ic
 186 0094 00000000 	 .word i_beta
 187 0098 00000000 	 .word cos_theta_fast
 188 009c 00000000 	 .word sin_theta_fast
 189 00a0 00000000 	 .word i_d
 190 00a4 00000000 	 .word i_q
 191              	 .cfi_endproc
 192              	.LFE196:
 194              	 .section .text.dq_abc,"ax",%progbits
 195              	 .align 2
 196              	 .global dq_abc
 197              	 .thumb
 198              	 .thumb_func
 200              	dq_abc:
 201              	.LFB197:
  45:../transform.c **** 
  46:../transform.c **** /*
  47:../transform.c ****  * Convert two-phase balanced sinusoidal signals to three-phase electrical signals
  48:../transform.c ****  */
  49:../transform.c **** void dq_abc(void)
  50:../transform.c **** {
 202              	 .loc 1 50 0
 203              	 .cfi_startproc
 204              	 
 205              	 
 206              	 
 207 0000 80B4     	 push {r7}
 208              	.LCFI4:
 209              	 .cfi_def_cfa_offset 4
 210              	 .cfi_offset 7,-4
 211 0002 00AF     	 add r7,sp,#0
 212              	.LCFI5:
 213              	 .cfi_def_cfa_register 7
  51:../transform.c **** 
  52:../transform.c **** 	// The Inverse Park Transformation
  53:../transform.c **** 	u_alpha = u_d_ref * cos_theta_fast - u_q_ref * sin_theta_fast;
 214              	 .loc 1 53 0
 215 0004 364B     	 ldr r3,.L19
 216 0006 93ED007A 	 flds s14,[r3]
 217 000a 364B     	 ldr r3,.L19+4
 218 000c D3ED007A 	 flds s15,[r3]
 219 0010 27EE277A 	 fmuls s14,s14,s15
 220 0014 344B     	 ldr r3,.L19+8
 221 0016 D3ED006A 	 flds s13,[r3]
 222 001a 344B     	 ldr r3,.L19+12
 223 001c D3ED007A 	 flds s15,[r3]
 224 0020 66EEA77A 	 fmuls s15,s13,s15
 225 0024 77EE677A 	 fsubs s15,s14,s15
 226 0028 314B     	 ldr r3,.L19+16
 227 002a C3ED007A 	 fsts s15,[r3]
  54:../transform.c **** 	u_beta = u_q_ref * cos_theta_fast + u_d_ref * sin_theta_fast;
 228              	 .loc 1 54 0
 229 002e 2E4B     	 ldr r3,.L19+8
 230 0030 93ED007A 	 flds s14,[r3]
 231 0034 2B4B     	 ldr r3,.L19+4
 232 0036 D3ED007A 	 flds s15,[r3]
 233 003a 27EE277A 	 fmuls s14,s14,s15
 234 003e 284B     	 ldr r3,.L19
 235 0040 D3ED006A 	 flds s13,[r3]
 236 0044 294B     	 ldr r3,.L19+12
 237 0046 D3ED007A 	 flds s15,[r3]
 238 004a 66EEA77A 	 fmuls s15,s13,s15
 239 004e 77EE277A 	 fadds s15,s14,s15
 240 0052 284B     	 ldr r3,.L19+20
 241 0054 C3ED007A 	 fsts s15,[r3]
  55:../transform.c **** 
  56:../transform.c **** 	// The Inverse Clarke Transformation
  57:../transform.c **** 	u_a_ref = u_alpha;
 242              	 .loc 1 57 0
 243 0058 254B     	 ldr r3,.L19+16
 244 005a 1B68     	 ldr r3,[r3]
 245 005c 264A     	 ldr r2,.L19+24
 246 005e 1360     	 str r3,[r2]
  58:../transform.c **** 	u_b_ref = u_beta;
 247              	 .loc 1 58 0
 248 0060 244B     	 ldr r3,.L19+20
 249 0062 1B68     	 ldr r3,[r3]
 250 0064 254A     	 ldr r2,.L19+28
 251 0066 1360     	 str r3,[r2]
  59:../transform.c **** //	u_b_ref = (-u_alpha + SQRT_3 * u_beta) / 2;
  60:../transform.c **** //	u_c_ref = (-u_alpha - SQRT_3 * u_beta) / 2;
  61:../transform.c **** 
  62:../transform.c **** 	/*
  63:../transform.c **** 	 * Keeps the values in range of int16_t
  64:../transform.c **** 	 * Later on the Float values will be casted into Int
  65:../transform.c **** 	 */
  66:../transform.c **** 	if (u_a_ref > MAX_UINT_16)
 252              	 .loc 1 66 0
 253 0068 234B     	 ldr r3,.L19+24
 254 006a D3ED007A 	 flds s15,[r3]
 255 006e 9FED247A 	 flds s14,.L19+32
 256 0072 F4EEC77A 	 fcmpes s15,s14
 257 0076 F1EE10FA 	 fmstat
 258 007a 03DD     	 ble .L17
  67:../transform.c **** 	{
  68:../transform.c **** 		u_a_ref = MAX_UINT_16;
 259              	 .loc 1 68 0
 260 007c 1E4B     	 ldr r3,.L19+24
 261 007e 214A     	 ldr r2,.L19+36
 262 0080 1A60     	 str r2,[r3]
 263 0082 0DE0     	 b .L7
 264              	.L17:
  69:../transform.c **** 	}
  70:../transform.c **** 	else if (u_a_ref < MIN_UINT_16)
 265              	 .loc 1 70 0
 266 0084 1C4B     	 ldr r3,.L19+24
 267 0086 D3ED007A 	 flds s15,[r3]
 268 008a 9FED1F7A 	 flds s14,.L19+40
 269 008e F4EEC77A 	 fcmpes s15,s14
 270 0092 F1EE10FA 	 fmstat
 271 0096 03D5     	 bpl .L7
  71:../transform.c **** 	{
  72:../transform.c **** 		u_a_ref = MIN_UINT_16;
 272              	 .loc 1 72 0
 273 0098 174B     	 ldr r3,.L19+24
 274 009a 4FF04742 	 mov r2,#-956301312
 275 009e 1A60     	 str r2,[r3]
 276              	.L7:
  73:../transform.c **** 	}
  74:../transform.c **** 
  75:../transform.c **** 	if (u_b_ref > MAX_UINT_16)
 277              	 .loc 1 75 0
 278 00a0 164B     	 ldr r3,.L19+28
 279 00a2 D3ED007A 	 flds s15,[r3]
 280 00a6 9FED167A 	 flds s14,.L19+32
 281 00aa F4EEC77A 	 fcmpes s15,s14
 282 00ae F1EE10FA 	 fmstat
 283 00b2 03DD     	 ble .L18
  76:../transform.c **** 	{
  77:../transform.c **** 		u_b_ref = MAX_UINT_16;
 284              	 .loc 1 77 0
 285 00b4 114B     	 ldr r3,.L19+28
 286 00b6 134A     	 ldr r2,.L19+36
 287 00b8 1A60     	 str r2,[r3]
 288 00ba 0DE0     	 b .L4
 289              	.L18:
  78:../transform.c **** 	}
  79:../transform.c **** 	else if (u_b_ref < MIN_UINT_16)
 290              	 .loc 1 79 0
 291 00bc 0F4B     	 ldr r3,.L19+28
 292 00be D3ED007A 	 flds s15,[r3]
 293 00c2 9FED117A 	 flds s14,.L19+40
 294 00c6 F4EEC77A 	 fcmpes s15,s14
 295 00ca F1EE10FA 	 fmstat
 296 00ce 03D5     	 bpl .L4
  80:../transform.c **** 	{
  81:../transform.c **** 		u_a_ref = MIN_UINT_16;
 297              	 .loc 1 81 0
 298 00d0 094B     	 ldr r3,.L19+24
 299 00d2 4FF04742 	 mov r2,#-956301312
 300 00d6 1A60     	 str r2,[r3]
 301              	.L4:
  82:../transform.c **** 	}
  83:../transform.c **** 
  84:../transform.c **** //	if (u_c_ref > MAX_UINT_16)
  85:../transform.c **** //	{
  86:../transform.c **** //		u_a_ref = MAX_UINT_16;
  87:../transform.c **** //	}
  88:../transform.c **** //	else if (u_c_ref < MIN_UINT_16)
  89:../transform.c **** //	{
  90:../transform.c **** //		u_c_ref = MIN_UINT_16;
  91:../transform.c **** //	}
  92:../transform.c **** }
 302              	 .loc 1 92 0
 303 00d8 BD46     	 mov sp,r7
 304              	.LCFI6:
 305              	 .cfi_def_cfa_register 13
 306              	 
 307 00da 5DF8047B 	 ldr r7,[sp],#4
 308              	.LCFI7:
 309              	 .cfi_restore 7
 310              	 .cfi_def_cfa_offset 0
 311 00de 7047     	 bx lr
 312              	.L20:
 313              	 .align 2
 314              	.L19:
 315 00e0 00000000 	 .word u_d_ref
 316 00e4 00000000 	 .word cos_theta_fast
 317 00e8 00000000 	 .word u_q_ref
 318 00ec 00000000 	 .word sin_theta_fast
 319 00f0 00000000 	 .word u_alpha
 320 00f4 00000000 	 .word u_beta
 321 00f8 00000000 	 .word u_a_ref
 322 00fc 00000000 	 .word u_b_ref
 323 0100 00FEFF46 	 .word 1191181824
 324 0104 00FEFF46 	 .word 1191181824
 325 0108 000000C7 	 .word -956301312
 326              	 .cfi_endproc
 327              	.LFE197:
 329              	 .section .text.compute_fast_speed,"ax",%progbits
 330              	 .align 2
 331              	 .global compute_fast_speed
 332              	 .thumb
 333              	 .thumb_func
 335              	compute_fast_speed:
 336              	.LFB198:
  93:../transform.c **** 
  94:../transform.c **** /*
  95:../transform.c ****  * Compute the speed based on the encoder increments, read from CCU40 Timer
  96:../transform.c ****  */
  97:../transform.c **** void compute_fast_speed(void)			//SPEED = 1 for testing
  98:../transform.c **** {
 337              	 .loc 1 98 0
 338              	 .cfi_startproc
 339              	 
 340              	 
 341              	 
 342 0000 80B4     	 push {r7}
 343              	.LCFI8:
 344              	 .cfi_def_cfa_offset 4
 345              	 .cfi_offset 7,-4
 346 0002 00AF     	 add r7,sp,#0
 347              	.LCFI9:
 348              	 .cfi_def_cfa_register 7
  99:../transform.c **** 	timer_value_fast = CCU40_CC40->TIMER;
 349              	 .loc 1 99 0
 350 0004 074B     	 ldr r3,.L22
 351 0006 1B6F     	 ldr r3,[r3,#112]
 352 0008 9AB2     	 uxth r2,r3
 353 000a 074B     	 ldr r3,.L22+4
 354 000c 1A80     	 strh r2,[r3]
 100:../transform.c **** //	speed_value_fast = timer_value_fast - timer_value_old_fast;
 101:../transform.c **** 	speed_value_fast = 1;
 355              	 .loc 1 101 0
 356 000e 074B     	 ldr r3,.L22+8
 357 0010 0122     	 movs r2,#1
 358 0012 1A80     	 strh r2,[r3]
 102:../transform.c **** 	timer_value_old_fast = timer_value_fast;
 359              	 .loc 1 102 0
 360 0014 044B     	 ldr r3,.L22+4
 361 0016 1A88     	 ldrh r2,[r3]
 362 0018 054B     	 ldr r3,.L22+12
 363 001a 1A80     	 strh r2,[r3]
 103:../transform.c **** }
 364              	 .loc 1 103 0
 365 001c BD46     	 mov sp,r7
 366              	.LCFI10:
 367              	 .cfi_def_cfa_register 13
 368              	 
 369 001e 5DF8047B 	 ldr r7,[sp],#4
 370              	.LCFI11:
 371              	 .cfi_restore 7
 372              	 .cfi_def_cfa_offset 0
 373 0022 7047     	 bx lr
 374              	.L23:
 375              	 .align 2
 376              	.L22:
 377 0024 00C10040 	 .word 1073791232
 378 0028 00000000 	 .word timer_value_fast
 379 002c 00000000 	 .word speed_value_fast
 380 0030 00000000 	 .word timer_value_old_fast
 381              	 .cfi_endproc
 382              	.LFE198:
 384              	 .section .text.compute_fast_mechanical_position,"ax",%progbits
 385              	 .align 2
 386              	 .global compute_fast_mechanical_position
 387              	 .thumb
 388              	 .thumb_func
 390              	compute_fast_mechanical_position:
 391              	.LFB199:
 104:../transform.c **** /*
 105:../transform.c ****  * Compute the mechanical position based on the speed value
 106:../transform.c ****  */
 107:../transform.c **** void compute_fast_mechanical_position(void)
 108:../transform.c **** {
 392              	 .loc 1 108 0
 393              	 .cfi_startproc
 394              	 
 395              	 
 396              	 
 397 0000 80B4     	 push {r7}
 398              	.LCFI12:
 399              	 .cfi_def_cfa_offset 4
 400              	 .cfi_offset 7,-4
 401 0002 00AF     	 add r7,sp,#0
 402              	.LCFI13:
 403              	 .cfi_def_cfa_register 7
 109:../transform.c **** 	mechanical_position_fast += speed_value_fast;
 404              	 .loc 1 109 0
 405 0004 054B     	 ldr r3,.L25
 406 0006 1B88     	 ldrh r3,[r3]
 407 0008 1AB2     	 sxth r2,r3
 408 000a 054B     	 ldr r3,.L25+4
 409 000c 1B68     	 ldr r3,[r3]
 410 000e 1344     	 add r3,r3,r2
 411 0010 034A     	 ldr r2,.L25+4
 412 0012 1360     	 str r3,[r2]
 110:../transform.c **** }
 413              	 .loc 1 110 0
 414 0014 BD46     	 mov sp,r7
 415              	.LCFI14:
 416              	 .cfi_def_cfa_register 13
 417              	 
 418 0016 5DF8047B 	 ldr r7,[sp],#4
 419              	.LCFI15:
 420              	 .cfi_restore 7
 421              	 .cfi_def_cfa_offset 0
 422 001a 7047     	 bx lr
 423              	.L26:
 424              	 .align 2
 425              	.L25:
 426 001c 00000000 	 .word speed_value_fast
 427 0020 00000000 	 .word mechanical_position_fast
 428              	 .cfi_endproc
 429              	.LFE199:
 431              	 .section .text.compute_fast_electrical_position,"ax",%progbits
 432              	 .align 2
 433              	 .global compute_fast_electrical_position
 434              	 .thumb
 435              	 .thumb_func
 437              	compute_fast_electrical_position:
 438              	.LFB200:
 111:../transform.c **** 
 112:../transform.c **** /*
 113:../transform.c ****  * Compute the module of the electrical position based on the mechanical position
 114:../transform.c ****  */
 115:../transform.c **** void compute_fast_electrical_position(void)
 116:../transform.c **** {
 439              	 .loc 1 116 0
 440              	 .cfi_startproc
 441              	 
 442              	 
 443              	 
 444 0000 80B4     	 push {r7}
 445              	.LCFI16:
 446              	 .cfi_def_cfa_offset 4
 447              	 .cfi_offset 7,-4
 448 0002 00AF     	 add r7,sp,#0
 449              	.LCFI17:
 450              	 .cfi_def_cfa_register 7
 117:../transform.c **** 	electrical_resolution = encoder_resolution / pp;
 451              	 .loc 1 117 0
 452 0004 0D4B     	 ldr r3,.L28
 453 0006 1B88     	 ldrh r3,[r3]
 454 0008 1AB2     	 sxth r2,r3
 455 000a 0D4B     	 ldr r3,.L28+4
 456 000c 1B78     	 ldrb r3,[r3]
 457 000e 5BB2     	 sxtb r3,r3
 458 0010 92FBF3F3 	 sdiv r3,r2,r3
 459 0014 9AB2     	 uxth r2,r3
 460 0016 0B4B     	 ldr r3,.L28+8
 461 0018 1A80     	 strh r2,[r3]
 118:../transform.c **** 	electrical_position_modulo_fast = mechanical_position_fast % electrical_resolution;
 462              	 .loc 1 118 0
 463 001a 0B4B     	 ldr r3,.L28+12
 464 001c 1B68     	 ldr r3,[r3]
 465 001e 094A     	 ldr r2,.L28+8
 466 0020 1288     	 ldrh r2,[r2]
 467 0022 12B2     	 sxth r2,r2
 468 0024 93FBF2F1 	 sdiv r1,r3,r2
 469 0028 02FB01F2 	 mul r2,r2,r1
 470 002c 9B1A     	 subs r3,r3,r2
 471 002e 074A     	 ldr r2,.L28+16
 472 0030 1360     	 str r3,[r2]
 119:../transform.c **** }
 473              	 .loc 1 119 0
 474 0032 BD46     	 mov sp,r7
 475              	.LCFI18:
 476              	 .cfi_def_cfa_register 13
 477              	 
 478 0034 5DF8047B 	 ldr r7,[sp],#4
 479              	.LCFI19:
 480              	 .cfi_restore 7
 481              	 .cfi_def_cfa_offset 0
 482 0038 7047     	 bx lr
 483              	.L29:
 484 003a 00BF     	 .align 2
 485              	.L28:
 486 003c 00000000 	 .word encoder_resolution
 487 0040 00000000 	 .word pp
 488 0044 00000000 	 .word electrical_resolution
 489 0048 00000000 	 .word mechanical_position_fast
 490 004c 00000000 	 .word electrical_position_modulo_fast
 491              	 .cfi_endproc
 492              	.LFE200:
 494              	 .section .text.compute_fast_field,"ax",%progbits
 495              	 .align 2
 496              	 .global compute_fast_field
 497              	 .thumb
 498              	 .thumb_func
 500              	compute_fast_field:
 501              	.LFB201:
 120:../transform.c **** 
 121:../transform.c **** /*
 122:../transform.c ****  * Compute the electrical angle based on the electrical position
 123:../transform.c ****  * Compute the sin&cos of theta
 124:../transform.c ****  */
 125:../transform.c **** void compute_fast_field(void)
 126:../transform.c **** {
 502              	 .loc 1 126 0
 503              	 .cfi_startproc
 504              	 
 505              	 
 506 0000 80B5     	 push {r7,lr}
 507              	.LCFI20:
 508              	 .cfi_def_cfa_offset 8
 509              	 .cfi_offset 7,-8
 510              	 .cfi_offset 14,-4
 511 0002 00AF     	 add r7,sp,#0
 512              	.LCFI21:
 513              	 .cfi_def_cfa_register 7
 127:../transform.c **** 	theta_fast = electrical_position_modulo_fast * (2 * Pi) / electrical_resolution;
 514              	 .loc 1 127 0
 515 0004 134B     	 ldr r3,.L32
 516 0006 1B68     	 ldr r3,[r3]
 517 0008 07EE903A 	 fmsr s15,r3
 518 000c F8EEE77A 	 fsitos s15,s15
 519 0010 9FED117A 	 flds s14,.L32+4
 520 0014 27EE877A 	 fmuls s14,s15,s14
 521 0018 104B     	 ldr r3,.L32+8
 522 001a 1B88     	 ldrh r3,[r3]
 523 001c 1BB2     	 sxth r3,r3
 524 001e 07EE903A 	 fmsr s15,r3
 525 0022 F8EEE77A 	 fsitos s15,s15
 526 0026 C7EE277A 	 fdivs s15,s14,s15
 527 002a 0D4B     	 ldr r3,.L32+12
 528 002c C3ED007A 	 fsts s15,[r3]
 128:../transform.c **** 	if (loop_control & TUNE_REF_LOOP_MSK)
 529              	 .loc 1 128 0
 530 0030 0C4B     	 ldr r3,.L32+16
 531 0032 1B78     	 ldrb r3,[r3]
 532 0034 DBB2     	 uxtb r3,r3
 533 0036 5BB2     	 sxtb r3,r3
 534 0038 002B     	 cmp r3,#0
 535 003a 03DA     	 bge .L31
 129:../transform.c **** 	{
 130:../transform.c **** 		theta_fast = 0;
 536              	 .loc 1 130 0
 537 003c 084B     	 ldr r3,.L32+12
 538 003e 4FF00002 	 mov r2,#0
 539 0042 1A60     	 str r2,[r3]
 540              	.L31:
 131:../transform.c **** 	}
 132:../transform.c **** 	sincosf(theta_fast, &sin_theta_fast, &cos_theta_fast);
 541              	 .loc 1 132 0
 542 0044 064B     	 ldr r3,.L32+12
 543 0046 1B68     	 ldr r3,[r3]
 544 0048 1846     	 mov r0,r3
 545 004a 0749     	 ldr r1,.L32+20
 546 004c 074A     	 ldr r2,.L32+24
 547 004e FFF7FEFF 	 bl sincosf
 133:../transform.c **** }
 548              	 .loc 1 133 0
 549 0052 80BD     	 pop {r7,pc}
 550              	.L33:
 551              	 .align 2
 552              	.L32:
 553 0054 00000000 	 .word electrical_position_modulo_fast
 554 0058 D00FC940 	 .word 1086918608
 555 005c 00000000 	 .word electrical_resolution
 556 0060 00000000 	 .word theta_fast
 557 0064 00000000 	 .word loop_control
 558 0068 00000000 	 .word sin_theta_fast
 559 006c 00000000 	 .word cos_theta_fast
 560              	 .cfi_endproc
 561              	.LFE201:
 563              	 .text
 564              	.Letext0:
 565              	 .file 2 "c:\\dave-ide-4.4.2-64bit\\eclipse\\arm-gcc-49\\arm-none-eabi\\include\\machine\\_default_types.h"
 566              	 .file 3 "c:\\dave-ide-4.4.2-64bit\\eclipse\\arm-gcc-49\\arm-none-eabi\\include\\stdint.h"
 567              	 .file 4 "C:/GitHub/Stepper_drive/Libraries/CMSIS/Infineon/XMC4800_series/Include/XMC4800.h"
 568              	 .file 5 "c:\\dave-ide-4.4.2-64bit\\eclipse\\arm-gcc-49\\arm-none-eabi\\include\\math.h"
 569              	 .file 6 "C:/GitHub/Stepper_drive/Libraries/CMSIS/Include/core_cm4.h"
 570              	 .file 7 "../main.h"
 571              	 .file 8 "../driver_adc.h"
 572              	 .file 9 "../pi_regulator.h"
 573              	 .file 10 "../state_machine.h"
DEFINED SYMBOLS
                            *ABS*:00000000 transform.c
                            *COM*:00000004 CCU8_CC8_CR1_CR1_Value
    {standard input}:25     .bss.mechanical_position_fast:00000000 mechanical_position_fast
    {standard input}:22     .bss.mechanical_position_fast:00000000 $d
    {standard input}:32     .bss.electrical_position_modulo_fast:00000000 electrical_position_modulo_fast
    {standard input}:29     .bss.electrical_position_modulo_fast:00000000 $d
    {standard input}:39     .bss.theta_fast:00000000 theta_fast
    {standard input}:36     .bss.theta_fast:00000000 $d
    {standard input}:46     .bss.sin_theta_fast:00000000 sin_theta_fast
    {standard input}:43     .bss.sin_theta_fast:00000000 $d
    {standard input}:53     .bss.cos_theta_fast:00000000 cos_theta_fast
    {standard input}:50     .bss.cos_theta_fast:00000000 $d
    {standard input}:60     .bss.timer_value_fast:00000000 timer_value_fast
    {standard input}:57     .bss.timer_value_fast:00000000 $d
    {standard input}:67     .bss.timer_value_old_fast:00000000 timer_value_old_fast
    {standard input}:64     .bss.timer_value_old_fast:00000000 $d
    {standard input}:74     .bss.speed_value_fast:00000000 speed_value_fast
    {standard input}:71     .bss.speed_value_fast:00000000 $d
    {standard input}:81     .data.encoder_resolution:00000000 encoder_resolution
    {standard input}:78     .data.encoder_resolution:00000000 $d
    {standard input}:87     .data.pp:00000000 pp
    {standard input}:94     .bss.electrical_resolution:00000000 electrical_resolution
    {standard input}:91     .bss.electrical_resolution:00000000 $d
                            *COM*:00000004 u_a_ref
                            *COM*:00000004 u_b_ref
                            *COM*:00000004 u_c_ref
                            *COM*:00000004 i_d
                            *COM*:00000004 i_q
                            *COM*:00000004 i_alpha
                            *COM*:00000004 i_beta
                            *COM*:00000004 u_alpha
                            *COM*:00000004 u_beta
    {standard input}:106    .text.abc_dq:00000000 $t
    {standard input}:111    .text.abc_dq:00000000 abc_dq
    {standard input}:183    .text.abc_dq:00000088 $d
    {standard input}:195    .text.dq_abc:00000000 $t
    {standard input}:200    .text.dq_abc:00000000 dq_abc
    {standard input}:315    .text.dq_abc:000000e0 $d
    {standard input}:330    .text.compute_fast_speed:00000000 $t
    {standard input}:335    .text.compute_fast_speed:00000000 compute_fast_speed
    {standard input}:377    .text.compute_fast_speed:00000024 $d
    {standard input}:385    .text.compute_fast_mechanical_position:00000000 $t
    {standard input}:390    .text.compute_fast_mechanical_position:00000000 compute_fast_mechanical_position
    {standard input}:426    .text.compute_fast_mechanical_position:0000001c $d
    {standard input}:432    .text.compute_fast_electrical_position:00000000 $t
    {standard input}:437    .text.compute_fast_electrical_position:00000000 compute_fast_electrical_position
    {standard input}:486    .text.compute_fast_electrical_position:0000003c $d
    {standard input}:495    .text.compute_fast_field:00000000 $t
    {standard input}:500    .text.compute_fast_field:00000000 compute_fast_field
    {standard input}:553    .text.compute_fast_field:00000054 $d
                     .debug_frame:00000010 $d

UNDEFINED SYMBOLS
ia
ic
u_d_ref
u_q_ref
sincosf
loop_control
